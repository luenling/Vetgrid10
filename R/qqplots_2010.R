library(hexbin)
setwd("/Volumes/Temp/Lukas/Data/Vienna_2010/Polymorphisms_Filtered/CMH/FDR")
obs_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.obsP")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_42.0_beta_r1_60.20_r2_97.09_r3_162.00_nullP.out")
nl_oP = -1 * log10(obs_Pval)
nl_dP1 = -1 * log10(dist_Pval)
par(bg="white")
qqplot(nl_dP1,nl_oP,xlab=expression(paste("-log(P",scriptstyle(null),")")),ylab=expression(paste("-log(P",scriptstyle(obs),")")))
abline(0,1,col="red",lty=2)
title(main=expression(paste("Vienna 2010, filtered, ",alpha,"=42 ", beta," by cov")))
dev.print(png,width=640,file="qqplot_vienna2010_filt_a42_b_cov.png")
#for fixed beta
s_nl_oP <- sort(nl_oP,decreasing=F)
s_nl_dP <- sort(nl_dP1,decreasing=F)
bin <- hexbin(s_nl_dP,s_nl_oP,xbins=400,xlab=expression(paste("-log(P",scriptstyle(null),")")),ylab=expression(paste("-log(P",scriptstyle(obs),")")))
pp<-plot(bin,legend=FALSE,style="constant.col",main=expression(paste("Vienna 2010, filtered, ",alpha,"=42 ", beta," by coverage")))
hvp=hexViewport(bin)
hexVP.abline(hvp,0,1,col="red",lty=2)

qqplot_hex <- function(obs_Pval,dist_Pval,title,alpha,beta=" by coverage"){
	nl_oP = -1 * log10(obs_Pval)
	nl_dP1 = -1 * log10(dist_Pval)
	s_nl_oP <- sort(nl_oP,decreasing=F)
	s_nl_dP <- sort(nl_dP1,decreasing=F)
	bin <- hexbin(s_nl_dP,s_nl_oP,xbins=400,xlab=expression(paste("-log(P",scriptstyle(null),")")),ylab=expression(paste("-log(P",scriptstyle(obs),")")))
	pp<-plot(bin,legend=FALSE,style="constant.col",main=bquote(paste(.(title),alpha,"=",.(alpha)," ", beta,.(beta))))
	hvp=hexViewport(bin)
	hexVP.abline(hvp,0,1,col="red",lty=2)
}
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="42")

setwd("/Volumes/Temp/Lukas/Data/Vienna_2010/Polymorphisms_Filtered/CMH/FDR")
obs_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.obsP")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_8.0_beta_r1_11.47_r2_18.49_r3_30.86_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="8")
dev.copy2pdf(file="vie2010_filt_a_8_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_10.0_beta__r1_14.3333333333_r2_23.1168831169_r3_38.5714285714_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="10")
dev.copy2pdf(file="vie2010_filt_a_10_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_15.0_beta__r1_21.5_r2_34.6753246753_r3_57.8571428571_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="15")
dev.copy2pdf(file="vie2010_filt_a_15_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_12.0_beta_r1_17.20_r2_27.74_r3_46.29_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="12")
dev.copy2pdf(file="vie2010_filt_a_12_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_14.0_beta_r1_20.07_r2_32.36_r3_54.00_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="14")
dev.copy2pdf(file="vie2010_filt_a_14_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_16.0_beta_r1_22.93_r2_36.99_r3_61.71_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="16")
dev.copy2pdf(file="vie2010_filt_a_16_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_9.0_beta_r1_12.90_r2_20.81_r3_34.71_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="9")
dev.copy2pdf(file="vie2010_filt_a_9_b_cov_hex.pdf")
dist_Pval=scan("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout_a_11.0_beta_r1_15.77_r2_25.43_r3_42.43_nullP.out")
qqplot_hex(obs_Pval,dist_Pval,title="Vienna 2010, filtered, ",alpha="11")
dev.copy2pdf(file="vie2010_filt_a_11_b_cov_hex.pdf")

# reading Fisher test results
fisher_2010 = read.table("females_pI25_pII25_pIII25_pIel_pIIel_pIIIel_q20_filtered_masked_mc7_only_chroms_noAceto_mct15_mcv25.cmhout.fishcomp",skip=1,na.strings=c("na","NA"))
fisher_2010=fisher_2010[complete.cases(fisher_2010),]



