setwd("/Volumes/Temp/Lukas/Data/SA_A7/BGI_100_101/Polymorphims/CMH/")
ps =scan("FDR/sa_a7_VL1_VL4_VL5_VVD1_VVD4_VVD5_q20_filt_mc2_chroms_only_mc_5_mcov_15_mct8_mcv15_no_Na_no_SB.cmhout_a_18.0_beta_r1_20.96_r2_26.61_r3_17.26_nullP.out_10x")
ps = sort(ps)
obs_pval=read.table("sa_a7_VL1_VL4_VL5_VVD1_VVD4_VVD5_q20_filt_mc2_chroms_only_mc_5_mcov_15_mct8_mcv15_no_Na_no_SB_mc8_maf_gt_5.gwas",header=T)
obs_pval=obs_pval[order(obs_pval$P),]
n_ratio=length(obs_pval$P)/length(ps)
obs_pval$Q = 1.0
ranks = 1:1000
for (r in ranks)
	{
	ps_smaller =  n_ratio*sum(ps < obs_pval$P[r])
	#cat ("r=", r, obs_pval$P[r], ps_smaller/r, "\n")
	obs_pval$Q[r]=ps_smaller/r
# not ps20_smaller/(r + ps20_smaller) as r already contains the FP
	}


First 50:
        CHR      BP        SNP            P           Q
1638564  3L 1084990 snp1638564 3.879513e-43 0.000000000
1638570  3L 1085137 snp1638570 9.053816e-38 0.000000000
1639073  3L 1094154 snp1639073 7.058224e-31 0.000000000
1638871  3L 1090136 snp1638871 6.611088e-28 0.000000000
1638277  3L 1079020 snp1638277 2.015648e-26 0.000000000
1638594  3L 1085454 snp1638594 2.245055e-26 0.000000000
1638379  3L 1080908 snp1638379 7.155504e-25 0.000000000
1638618  3L 1085642 snp1638618 1.158198e-24 0.000000000
1638659  3L 1086356 snp1638659 1.549277e-24 0.000000000
1638602  3L 1085521 snp1638602 2.190435e-24 0.000000000
1638603  3L 1085530 snp1638603 3.648567e-24 0.000000000
1638350  3L 1080371 snp1638350 4.066619e-24 0.000000000
1638382  3L 1080934 snp1638382 3.244166e-23 0.000000000
1638383  3L 1080935 snp1638383 2.106575e-22 0.000000000
1638256  3L 1078685 snp1638256 9.759931e-22 0.000000000
1638381  3L 1080915 snp1638381 1.113332e-21 0.000000000
1638607  3L 1085536 snp1638607 1.830161e-21 0.000000000
1638868  3L 1090129 snp1638868 2.794320e-20 0.000000000
1639310  3L 1099074 snp1639310 2.895557e-20 0.000000000
1639099  3L 1094564 snp1639099 4.837063e-20 0.000000000
1638396  3L 1081063 snp1638396 2.054127e-19 0.004761905
1638895  3L 1090646 snp1638895 3.632442e-19 0.009090909
1639192  3L 1097325 snp1639192 3.761940e-19 0.008695652
1638067  3L 1074402 snp1638067 6.521758e-19 0.012500000
1640177  3L 1116792 snp1640177 7.571132e-19 0.012000000
1639312  3L 1099084 snp1639312 1.053021e-18 0.019230769
1638335  3L 1080180 snp1638335 1.083393e-18 0.022222222
1638175  3L 1076872 snp1638175 2.571948e-18 0.025000000
1638333  3L 1080172 snp1638333 4.792614e-18 0.027586207
1639311  3L 1099077 snp1639311 8.169640e-18 0.030000000
1639078  3L 1094165 snp1639078 1.296561e-17 0.038709677
1639263  3L 1098471 snp1639263 1.612295e-17 0.040625000
1638334  3L 1080174 snp1638334 1.768174e-17 0.039393939
3670414   X 8888865 snp3670414 2.282163e-17 0.041176471
1639507  3L 1104150 snp1639507 2.767286e-17 0.040000000
1638876  3L 1090270 snp1638876 2.887663e-17 0.038888889
1639509  3L 1104190 snp1639509 3.800265e-17 0.043243243
1638066  3L 1074289 snp1638066 8.401975e-17 0.057894737
1639506  3L 1104145 snp1639506 1.110957e-16 0.061538462
1638863  3L 1090064 snp1638863 1.721905e-16 0.062500000
1639232  3L 1098118 snp1639232 1.916206e-16 0.060975610
1640761  3L 1127547 snp1640761 5.641966e-16 0.090476190
1638397  3L 1081068 snp1638397 1.483080e-15 0.113953488
1639230  3L 1098049 snp1639230 2.633597e-15 0.136363636
1638945  3L 1091744 snp1638945 3.256859e-15 0.144444444
21179    2L  841966   snp21179 3.575673e-15 0.147826087
1638257  3L 1078686 snp1638257 3.797996e-15 0.144680851
1638576  3L 1085230 snp1638576 5.480022e-15 0.158333333
1639102  3L 1094738 snp1639102 7.141230e-15 0.171428571
1640071  3L 1114988 snp1640071 7.718592e-15 0.170000000
